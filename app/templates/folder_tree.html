{% extends "base.html" %}
{% block content %}

<h2 class="text-2xl font-bold mb-4">Sơ đồ hệ thống (Tree View)</h2>

<div id="tree-container" class="p-4 border rounded bg-white shadow" style="width: 450px;">
    <ul id="tree-root" class="tree"></ul>
</div>

<!-- ================= MODAL TẠO THƯ MỤC (CHỈ 1 BẢN DUY NHẤT) ================= -->
<div id="createFolderModal" class="modal-bg hidden">
    <div class="modal-box">
        <h3 class="modal-title">Tạo thư mục mới</h3>

        <label class="modal-label">Tên thư mục:</label>
        <input id="newFolderName" type="text" class="modal-input">

        <label class="modal-label">Mô tả:</label>
        <textarea id="newFolderDesc" class="modal-textarea"></textarea>

        <input id="create_parent_id" type="hidden">
        <input id="create_level" type="hidden">

        <div class="modal-actions">
            <button id="btnCreateFolder" class="modal-btn modal-btn-primary">Tạo mới</button>
            <button id="btnCancelCreate" class="modal-btn">Hủy</button>
        </div>
    </div>
</div>
<!-- ===================================================== -->

<script src="{{ url_for('static', filename='js/folder_tree.js') }}"></script>

<style>
    .hidden {
        display: none !important;
    }
    ul.tree { padding-left: 20px; list-style-type: none; }
    .tree-node {
        cursor: pointer;
        padding: 4px 0;
        user-select: none;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .folder { font-weight: bold; }
    .caret::before {
        content: "▶";
        display: inline-block;
        margin-right: 6px;
        transition: transform .15s;
        font-size: 12px;
    }
    .caret-down::before {
        transform: rotate(90deg);
    }
    .nested { display: none; }
    .active { display: block; }

    .add-btn {
        margin-left: 6px;
        padding: 1px 6px;
        border: 1px solid #999;
        background: #f2f2f2;
        cursor: pointer;
        font-size: 12px;
        border-radius: 3px;
    }
    .add-btn:hover { background: #e6e6e6; }

    /* ====== MODAL CSS ====== */
    .modal-bg {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
    .modal-box {
        background: white;
        padding: 20px;
        width: 350px;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .modal-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 12px;
    }
    .modal-label { display: block; margin-top: 10px; font-weight: 600; }
    .modal-input, .modal-textarea {
        width: 100%;
        margin-top: 4px;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .modal-textarea { height: 70px; }
    .modal-actions {
        margin-top: 14px;
        text-align: right;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    .modal-btn {
        padding: 6px 12px;
        border: 1px solid #999;
        background: #f2f2f2;
        border-radius: 4px;
        cursor: pointer;
    }
    .modal-btn-primary {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
</style>

{% endblock %}
